<!-- PoC: tensorboard for proteins -->
<html>
    <body>
    <style>
    body {
        background-color: #1e1e1e;
        color: #d4d4d4;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100vh;
    }
    html {
        overflow: hidden;
        height: 100vh;
    }
    form {
        width: 100%;
        max-width: 100vw;
        box-sizing: border-box;
    }
    #dropZone {
        width: 150px;
        height: 120px;
        border: 3px dashed #3e3e42;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        background-color: #1e1e1e;
        transition: all 0.3s ease;
    }
    #dropZone:hover, #dropZone.dragover {
        border-color: #007acc;
        background-color: #252526;
    }
    #dropZoneText {
        text-align: center;
        color: #cccccc;
        font-size: 16px;
    }
    #fileInput {
        display: none;
    }
    #fastaText {
        width: 360px;
        height: 120px;
        resize: none;
        box-sizing: border-box;
        background-color: #1e1e1e;
        color: #d4d4d4;
        border: 1px solid #3e3e42;
        border-radius: 3px;
        padding: 10px;
        font-family: 'Consolas', 'Courier New', monospace;
    }
    .container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding-left: 210px;
        padding-top: 530px;
        justify-content: flex-start;
        background-color: #1e1e1e;
        box-sizing: border-box;
        max-width: 100vw;
        height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
        gap: 10px;
    }
    .sections-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        width: 100%;
    }
    .container::-webkit-scrollbar {
        width: 10px;
    }
    .container::-webkit-scrollbar-track {
        background: #1e1e1e;
    }
    .container::-webkit-scrollbar-thumb {
        background: #424242;
    }
    .container::-webkit-scrollbar-thumb:hover {
        background: #4e4e4e;
    }
    .left-section {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .right-section {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .textarea-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-start;
    }
    .left-section button {
        width: 100%;
        max-width: 300px;
    }
    .button-group {
        display: flex;
        gap: 5px;
        width: 100%;
    }
    .button-group button {
        flex: 1;
    }
    button {
        background-color: #0e639c;
        color: #ffffff;
        border: 1px solid #3e3e42;
        padding: 6px 12px;
        border-radius: 2px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.2s;
    }
    button:hover {
        background-color: #1177bb;
        border-color: #007acc;
    }
    button:active {
        background-color: #007acc;
    }
    button:disabled {
        background-color: #3e3e42;
        color: #858585;
        cursor: not-allowed;
        border-color: #2d2d30;
    }
    #molstar-viewer {
        width: calc(100vw - 200px);
        height: 520px;
        border: 1px solid #454545;
        margin-left: 200px;
        position: fixed;
        top: 0px;
        left: 0px;
        background-color: #1e1e1e;
        box-sizing: border-box;
    }
    .msp-plugin .msp-layout-standard {
        border: 1px solid #454545 !important;
    }
    .msp-plugin .msp-viewport-top-left-controls .msp-traj-controls {
        background-color: #eeece7 !important;
    }
    #requestList {
        position: fixed;
        top: 50px;
        left: 0px;
        width: 200px;
        height: calc(100vh - 170px);
        overflow-y: auto;
        border-right: 1px solid #2d2d30;
        background-color: #252526;
        box-sizing: border-box;
    }
    #requestList::-webkit-scrollbar {
        width: 10px;
    }
    #requestList::-webkit-scrollbar-track {
        background: #252526;
    }
    #requestList::-webkit-scrollbar-thumb {
        background: #424242;
    }
    #requestList::-webkit-scrollbar-thumb:hover {
        background: #4e4e4e;
    }
    #requestList li {
        cursor: pointer;
        list-style: none;
        padding: 8px;
        color: #cccccc;
        font-size: 13px;
    }
    #requestList li:hover {
        background-color: #2a2d2e;
    }
    #requestList li.selected {
        background-color: #094771;
        color: #ffffff;
        border: 1px solid #007acc;
    }
    .download-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        padding: 0;
    }
    #requestSearch {
        position: fixed;
        top: 0px;
        left: 0px;
        width: 200px;
        padding: 10px;
        border: none;
        border-right: 1px solid #2d2d30;
        border-bottom: 1px solid #2d2d30;
        background-color: #252526;
        box-sizing: border-box;
    }
    #requestSearch input {
        width: 100%;
        padding: 8px;
        border: 1px solid #3e3e42;
        border-radius: 3px;
        box-sizing: border-box;
        background-color: #3c3c3c;
        color: #cccccc;
        font-size: 13px;
    }
    #requestSearch input:focus {
        outline: none;
        border-color: #007acc;
        background-color: #1e1e1e;
    }
    #requestSearch input::placeholder {
        color: #858585;
    }
    #statusDisplay {
        position: fixed;
        bottom: 0px;
        left: 0px;
        width: 200px;
        height: 120px;
        padding: 8px 10px;
        background-color: #252526;
        border-top: 2px solid #454545;
        border-right: 1px solid #2d2d30;
        font-size: 10px;
        color: #cccccc;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
    }
    #logDisplay {
        flex: 1;
        overflow-y: auto;
        font-family: 'Consolas', 'Courier New', monospace;
        white-space: pre-wrap;
        word-break: break-all;
        margin-top: 5px;
        padding: 5px;
        background-color: #0c0c0c;
        border: 1px solid #2d2d30;
        border-radius: 2px;
    }
    #logDisplay::-webkit-scrollbar {
        width: 5px;
    }
    #logDisplay::-webkit-scrollbar-track {
        background: #0c0c0c;
    }
    #logDisplay::-webkit-scrollbar-thumb {
        background: #424242;
    }
    #statusDisplay .status-item {
        display: flex;
        justify-content: space-between;
        margin: 2px 0;
    }
    #statusDisplay .status-free {
        color: #4ec9b0;
    }
    #statusDisplay .status-busy {
        color: #f48771;
    }
    #fileList {
        color: #cccccc;
        font-size: 13px;
    }
    </style>
    <div id="requestSearch"></div>
    <div id="statusDisplay">
        <div class="status-item">
            <span>GPU log:</span>
            <span id="gpuStatus" class="status-free">free</span>
        </div>
        <div id="logDisplay"></div>
    </div>
    <div id="molstar-viewer"></div>
    <div id="requestList"></div>
    <form method="post" enctype="multipart/form-data" action="/boltz" id="uploadForm">
    <div class="container">
        <div style="width: calc(100% - 20px);">
            <input type="text" id="argsInput" value="--diffusion_samples 5 --write_embeddings False --seed 0" style="width: 100%; padding: 8px; background-color: #1e1e1e; color: #d4d4d4; border: 1px solid #3e3e42; border-radius: 3px; font-family: 'Consolas', 'Courier New', monospace; font-size: 13px; box-sizing: border-box;">
        </div>
        <div class="sections-wrapper">
            <div class="left-section">
                <div id="dropZone">
                    <div id="dropZoneText">
                        <p>üìÅ Drop files here</p>
                        <p style="font-size: 12px; margin-top: 10px;">or click to browse</p>
                    </div>
                    <input type="file" name="files" multiple accept=".fasta,.yaml" id="fileInput">
                </div>
                <div id="fileList" style="text-align: center; "></div>
                <button type="submit" onclick="window.useFilesOnly=true">Predict file(s)</button>
            </div>
            <div class="right-section">
                <div class="textarea-wrapper">
                    <textarea name="fasta_text" id="fastaText" style="margin-bottom: 10px;">&gt;A|Protein
ADAMADADADAD
>B|SMILES
O=C=O</textarea>
                </div>
                <div class="button-group">
                    <button type="submit" onclick="window.formatType='fasta'">Predict as FASTA</button>
                    <button type="submit" onclick="window.formatType='yaml'">Predict as YAML</button>
                </div>
                <div id="toggleConfidence" style="position: fixed; right: 10px; top: 475px; z-index: 1000; background: rgba(0, 0, 0, 0.4); padding: 8px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 8px; user-select: none;">
                    <input type="checkbox" id="confidenceCheckbox" style="cursor: pointer;">
                    <span style="color: #d4a74d; font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Confidence</span>
                </div>
                <div id="confidenceMetrics" style="position: fixed; left: 214px; top: 50px; z-index: 1000; color: #d4d0c8; font-family: 'Helvetica Neue', 'Segoe UI', Helvetica, 'Source Sans Pro', Arial, sans-serif; font-size: 12px; user-select: text; cursor: text;">
                </div>
            </div>
        </div>
    </div>
    </form>
<script>
window.formatType = 'fasta';
window.useFilesOnly = false;
window.showingConfidence = false;
window.currentViewer = null;
window.currentPdbData = '';

// Download predictions for a request
function downloadPredictions(requestId) {
    const a = document.createElement('a');
    a.href = `/requests/${requestId}`;
    a.download = `predictions_${requestId}.zip`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Load request list on page load
async function loadRequestList() {
    try {
        const response = await fetch('/requests');
        const requests = await response.json();
        
        // Clear existing content
        const searchDiv = document.getElementById('requestSearch');
        const listDiv = document.getElementById('requestList');
        searchDiv.innerHTML = '';
        listDiv.innerHTML = '';
        
        if (requests.length === 0) {
            listDiv.innerHTML = '<p>No requests found</p>';
            return;
        }
        // Sort by id descending (largest first)
        const sortedRequests = requests.sort((a, b) => parseInt(b.id) - parseInt(a.id));
        
        // Create search bar
        const searchInput = document.createElement('input');
        searchInput.type = 'text';
        searchInput.placeholder = 'Search runs...';
        searchDiv.appendChild(searchInput);
        
        const ul = document.createElement('ul');
        ul.id = 'requestListUl';
        ul.style.margin = '0';
        ul.style.padding = '0';
        sortedRequests.forEach(req => {
            const li = document.createElement('li');
            const runName = getRunName(req.id);
            const timeAgo = getTimeAgo(req.timestamp);
            const timeStr = timeAgo ? ` ${timeAgo}` : '';
            li.innerHTML = `
                <span style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${req.id}: ${runName}${timeStr}</span>
                <button class="download-btn">‚¨áÔ∏è</button>
            `;
            li.style.display = 'flex';
            li.style.alignItems = 'center';
            li.style.gap = '10px';
            
            // Hover to visualize
            li.addEventListener('mouseenter', () => {
                loadAndVisualize(req.id);
                // Update URL
                const url = new URL(window.location);
                url.searchParams.set('run', req.id);
                window.history.replaceState({}, '', url);
            });
            
            // Click on button to download
            li.querySelector('.download-btn').onclick = (e) => {
                e.stopPropagation();
                downloadPredictions(req.id);
            };
            
            li.dataset.id = req.id;
            li.dataset.date = req.date;
            ul.appendChild(li);
        });
        
        listDiv.appendChild(ul);
        
        // Add search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const items = ul.querySelectorAll('li');
            let firstVisible = null;
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'flex';
                    if (!firstVisible) {
                        firstVisible = item;
                    }
                } else {
                    item.style.display = 'none';
                }
            });
            // Automatically visualize the first visible result
            if (firstVisible) {
                loadAndVisualize(firstVisible.dataset.id);
            }
        });
        
        // Check if there's a run parameter in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const runParam = urlParams.get('run');
        
        if (runParam && sortedRequests.some(r => r.id === runParam)) {
            // Load the run from URL parameter
            loadAndVisualize(runParam);
        } else if (sortedRequests.length > 0) {
            // Otherwise load the most recent structure
            loadAndVisualize(sortedRequests[0].id);
        }
    } catch (error) {
        console.error('Error loading requests:', error);
    }
}

async function loadAndVisualize(requestId) {
    try {
        // Highlight the selected run
        document.querySelectorAll('#requestListUl li').forEach(item => {
            item.classList.remove('selected');
            if (item.dataset.id === requestId) {
                item.classList.add('selected');
            }
        });
        
        const response = await fetch(`/requests/${requestId}`);
        if (!response.ok) throw new Error('Failed to download');
        const zipBlob = await response.blob();
        await unzipAndVisualize(zipBlob);
    } catch (error) {
        alert('Error loading request: ' + error.message);
    }
}

// Load list on page load
loadRequestList();

// Track previous busy state
let previouslyBusy = false;

// Update status display
async function updateStatus() {
    try {
        const gpuStatus = document.getElementById('gpuStatus');
        const logDisplay = document.getElementById('logDisplay');
        
        // Check if elements exist
        if (!gpuStatus || !logDisplay) {
            return;
        }
        
        const response = await fetch('/status');
        const status = await response.json();
        
        // Show busy if either lock is busy
        const isBusy = status.prediction_lock === 'busy' || status.msa_lock === 'busy';
        gpuStatus.textContent = isBusy ? 'busy' : 'free';
        gpuStatus.className = isBusy ? 'status-busy' : 'status-free';
        
        // If GPU went from busy to free, reload the list
        if (previouslyBusy && !isBusy) {
            await loadRequestList();
            // After reload, the list should auto-select based on URL param or most recent
        }
        previouslyBusy = isBusy;
        
        // Disable/enable predict buttons based on GPU status
        const predictButtons = document.querySelectorAll('#uploadForm button[type="submit"]');
        predictButtons.forEach(btn => {
            btn.disabled = isBusy;
        });
        
        // Update log display
        logDisplay.textContent = status.log || '';
        // Auto-scroll to bottom
        logDisplay.scrollTop = logDisplay.scrollHeight;
    } catch (error) {
        console.error('Failed to update status:', error);
    }
}

// Update status immediately and then every 100ms
updateStatus();
setInterval(updateStatus, 100);

// Drag and drop functionality
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');

dropZone.addEventListener('click', () => fileInput.click());

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = Array.from(e.dataTransfer.files);
    fileInput.files = e.dataTransfer.files;
    updateFileList();
});

fileInput.addEventListener('change', () => {
    updateFileList();
});

function updateFileList() {
    const files = Array.from(fileInput.files);
    if (files.length > 0) {
        fileList.innerHTML = '<strong>Selected files:</strong><br>' + 
            files.map(f => f.name).join('<br>');
    } else {
        fileList.innerHTML = '';
    }
}

document.getElementById('uploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    console.log('Predicting... This may take a while.');
    const formData = new FormData();
    
    // Get and validate args
    const argsInput = document.getElementById('argsInput');
    const args = argsInput.value.trim();
    
    // Validate args: only allow alphanumeric, spaces, hyphens, underscores
    if (args && !/^[a-zA-Z0-9\s\-_]+$/.test(args)) {
        alert('Invalid args: only alphanumeric characters, spaces, hyphens, and underscores are allowed');
        return false;
    }
    
    // Handle file input
    if (window.useFilesOnly) {
        const fileInput = document.getElementById('fileInput');
        if (fileInput.files.length === 0) {
            alert('Please upload at least one file');
            window.useFilesOnly = false;
            return false;
        }
        Array.from(fileInput.files).forEach(f => formData.append('files', f));
        window.useFilesOnly = false;
    } else {
        const textarea = document.getElementById('fastaText');
        if (textarea.value.trim()) {
            const format = window.formatType || 'fasta';
            const ext = format === 'yaml' ? '.yaml' : '.fasta';
            const blob = new Blob([textarea.value], {type: 'text/plain'});
            const file = new File([blob], 'input' + ext, {type: 'text/plain'});
            formData.append('files', file);
        }
        const fileInput = document.getElementById('fileInput');
        if (fileInput.files.length > 0) {
            Array.from(fileInput.files).forEach(f => formData.append('files', f));
        }
        window.formatType = 'fasta';
    }
    
    // Add args to formData if present
    if (args) {
        formData.append('args', args);
    }
    
    try {
        const response = await fetch('/boltz', {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Prediction failed (${response.status}): ${errorText || 'Unknown error'}`);
        }
        
        // Server now returns JSON with request_id
        const result = await response.json();
        
        // Check for errors (like GPU busy)
        if (result.error) {
            alert(result.error);
            return;
        }
        
        // Reload the request list to show the new/cached prediction
        await loadRequestList();
        
        // Visualize the returned request ID
        if (result.request_id) {
            await loadAndVisualize(result.request_id);
            // Update URL
            const url = new URL(window.location);
            url.searchParams.set('run', result.request_id);
            window.history.replaceState({}, '', url);
            
            if (result.status === 'cached') {
                console.log('Using cached prediction from run', result.request_id);
            }
        }
    } catch (error) {
        const errorMsg = error?.message || error?.toString() || 'Unknown error occurred';
        alert('Error: ' + errorMsg);
        console.error('Prediction error:', error);
    }
});

async function unzipAndVisualize(zipBlob) {
    try {
        // Load JSZip
        if (typeof JSZip === 'undefined') {
            await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js');
        }
        
        const zip = await JSZip.loadAsync(zipBlob);
        const files = [];
        for (const [filename, file] of Object.entries(zip.files)) {
            if (!file.dir) {
                files.push({name: filename, content: await file.async('string')});
            }
        }
        
        const structureFiles = files.filter(f => f.name.endsWith('.cif') || f.name.endsWith('.pdb'));
        
        if (structureFiles.length > 0) {
            // Load Molstar
            if (typeof molstar === 'undefined') {
                const cssLink = document.createElement('link');
                cssLink.rel = 'stylesheet';
                cssLink.href = 'https://unpkg.com/molstar@latest/build/viewer/molstar.css';
                document.head.appendChild(cssLink);
                await loadScript('https://unpkg.com/molstar@latest/build/viewer/molstar.js');
            }
            
            // Clear existing viewer if it exists
            const viewerDiv = document.getElementById('molstar-viewer');
            if (viewerDiv) {
                viewerDiv.innerHTML = '';
            }
            
            // Create viewer
            const viewer = await molstar.Viewer.create('molstar-viewer', {
                layoutIsExpanded: false,
                layoutShowControls: false,
                layoutShowSequence: false,
                layoutShowLog: false,
                layoutShowLeftPanel: false
            });
            window.debugViewer = viewer;
            window.currentViewer = viewer;
            
            // Set background color to match VSCode theme
            // Color is a numeric value in Molstar: RGB packed into an integer
            const bgColor = (62 << 16) | (62 << 8) | 66;  // #3e3e42 (VSCode lighter gray)
            await viewer.plugin.canvas3d.setProps({
                renderer: {
                    backgroundColor: bgColor
                },
                marking: {
                    enabled: true
                }
            });
            
            // Try to set button text colors for both left and right controls
            const controlsDivs = document.querySelectorAll('.msp-viewport-controls, .msp-viewport-top-left-controls, .msp-animation-viewport-controls');
            controlsDivs.forEach(div => {
                div.style.filter = 'invert(1) hue-rotate(180deg)';
            });
            
            // Force trajectory control backgrounds to transparent so they inherit parent gray
            const styleTrajectoryControls = () => {
                const trajControlsList = document.querySelectorAll('.msp-traj-controls');
                trajControlsList.forEach(trajControls => {
                    const allElements = [trajControls, ...trajControls.querySelectorAll('*')];
                    allElements.forEach(el => {
                        el.style.setProperty('background', 'transparent', 'important');
                        el.style.setProperty('background-color', 'transparent', 'important');
                    });
                });
            };
            
            // Watch for trajectory controls being added to DOM
            const observer = new MutationObserver((mutations) => {
                for (const mutation of mutations) {
                    if (mutation.addedNodes.length) {
                        styleTrajectoryControls();
                    }
                }
            });
            observer.observe(document.body, { childList: true, subtree: true });
            
            // Also try immediately in case they're already there
            styleTrajectoryControls();
            
            // Load PDB files as multi-model trajectory
            const pdbFiles = structureFiles.filter(f => f.name.endsWith('.pdb'));
            const cifFiles = structureFiles.filter(f => f.name.endsWith('.cif'));
            
            // Sort PDB files alphabetically for consistent ordering
            pdbFiles.sort((a, b) => a.name.localeCompare(b.name));
            
            // Parse and map confidence files to PDB files
            const confidenceFiles = files.filter(f => f.name.includes('confidence_') && f.name.endsWith('.json'));
            window.confidenceDataArray = [];
            
            if (pdbFiles.length > 0) {
                // For each PDB file, find its corresponding confidence file
                for (const pdbFile of pdbFiles) {
                    // Extract just the filename without path: "path/to/1_model_0.pdb" -> "1_model_0"
                    const pdbFileName = pdbFile.name.split('/').pop();
                    const pdbBaseName = pdbFileName.replace('.pdb', '');
                    
                    // Find matching confidence file: "confidence_1_model_0.json"
                    const matchingConfidence = confidenceFiles.find(f => {
                        const confFileName = f.name.split('/').pop();
                        return confFileName === `confidence_${pdbBaseName}.json`;
                    });
                    
                    if (matchingConfidence) {
                        try {
                            window.confidenceDataArray.push(JSON.parse(matchingConfidence.content));
                            console.log(`Matched ${pdbFileName} with ${matchingConfidence.name.split('/').pop()}`);
                        } catch (e) {
                            console.error('Error parsing confidence JSON:', e);
                            window.confidenceDataArray.push(null);
                        }
                    } else {
                        console.warn(`No confidence file found for ${pdbFileName}`);
                        window.confidenceDataArray.push(null);
                    }
                }
            }
            
            // Function to update confidence display for a given model index (0-based)
            window.updateConfidenceDisplay = function(modelIndex) {
                const metricsDiv = document.getElementById('confidenceMetrics');
                if (!metricsDiv || !window.confidenceDataArray || modelIndex >= window.confidenceDataArray.length) {
                    return;
                }
                
                const confidenceData = window.confidenceDataArray[modelIndex];
                if (!confidenceData) {
                    metricsDiv.innerHTML = 'No confidence data';
                    return;
                }
                
                // Display first 4 top-level numeric values
                const metricsHtml = [];
                for (const [key, value] of Object.entries(confidenceData)) {
                    if (typeof value === 'number') {
                        metricsHtml.push(`${key}: ${value.toFixed(3)}`);
                        if (metricsHtml.length >= 4) break;
                    }
                }
                metricsDiv.innerHTML = metricsHtml.join('<br>');
            };
            
            // Track current model and update confidence display
            let lastModelIndex = -1;
            if (window.modelTrackingInterval) {
                clearInterval(window.modelTrackingInterval);
            }
            window.modelTrackingInterval = setInterval(() => {
                // Find "Model X / Y" text in DOM - check all spans in trajectory controls
                const trajControls = document.querySelector('.msp-traj-controls');
                if (!trajControls) return;
                
                const spans = trajControls.querySelectorAll('span');
                for (const span of spans) {
                    if (span.textContent && span.textContent.includes('Model')) {
                        const match = span.textContent.match(/Model (\d+) \/ (\d+)/);
                        if (match) {
                            const currentModelIndex = parseInt(match[1]) - 1; // Convert to 0-based
                            if (currentModelIndex !== lastModelIndex) {
                                lastModelIndex = currentModelIndex;
                                console.log(`Model changed to index ${currentModelIndex}`);
                                window.updateConfidenceDisplay(currentModelIndex);
                            }
                            break;
                        }
                    }
                }
            }, 10);
            
            if (pdbFiles.length > 1) {
                // Combine multiple PDB files with MODEL tags
                let multiModelPdb = '';
                for (let i = 0; i < pdbFiles.length; i++) {
                    multiModelPdb += `MODEL     ${(i + 1).toString().padStart(4)}\n`;
                    multiModelPdb += pdbFiles[i].content;
                    multiModelPdb += `\nENDMDL\n`;
                }
                multiModelPdb += 'END\n';
                
                console.log('Loading', pdbFiles.length, 'models as trajectory');
                window.currentPdbData = multiModelPdb;
                await viewer.loadStructureFromData(multiModelPdb, 'pdb');
                
                // Display confidence for first model
                window.updateConfidenceDisplay(0);
                
                // Apply confidence coloring if checkbox is checked
                if (window.showingConfidence) {
                    const components = viewer.plugin.managers.structure.hierarchy.current.structures;
                    for (const s of components) {
                        await viewer.plugin.managers.structure.component.updateRepresentationsTheme(s.components, { color: 'plddt-confidence' });
                    }
                }
            } else if (pdbFiles.length === 1) {
                // Single PDB file
                window.currentPdbData = pdbFiles[0].content;
                await viewer.loadStructureFromData(pdbFiles[0].content, 'pdb');
                
                // Display confidence for single model
                window.updateConfidenceDisplay(0);
                
                // Apply confidence coloring if checkbox is checked
                if (window.showingConfidence) {
                    const components = viewer.plugin.managers.structure.hierarchy.current.structures;
                    for (const s of components) {
                        await viewer.plugin.managers.structure.component.updateRepresentationsTheme(s.components, { color: 'plddt-confidence' });
                    }
                }
            } else if (cifFiles.length > 0) {
                // Fall back to CIF if no PDB files
                await viewer.loadStructureFromData(cifFiles[0].content, 'mmcif');
                
                // Apply confidence coloring if checkbox is checked
                if (window.showingConfidence) {
                    const components = viewer.plugin.managers.structure.hierarchy.current.structures;
                    for (const s of components) {
                        await viewer.plugin.managers.structure.component.updateRepresentationsTheme(s.components, { color: 'plddt-confidence' });
                    }
                }
            } else {
                console.log('No structure files found');
            }
        } else {
            console.log('No structure files found');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error loading structure: ' + (error.message || String(error)));
    }
}

function loadScript(src) {
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
    });
}

// Toggle confidence checkbox
const confidenceCheckbox = document.getElementById('confidenceCheckbox');
const toggleConfidenceDiv = document.getElementById('toggleConfidence');

async function updateConfidence(checked) {
    window.showingConfidence = checked;
    const components = window.currentViewer.plugin.managers.structure.hierarchy.current.structures;
    for (const s of components) {
        const colorTheme = window.showingConfidence ? 'plddt-confidence' : 'chain-id';
        await window.currentViewer.plugin.managers.structure.component.updateRepresentationsTheme(s.components, { color: colorTheme });
    }
}

confidenceCheckbox?.addEventListener('change', (e) => updateConfidence(e.target.checked));
confidenceCheckbox?.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent div click handler from firing
});
toggleConfidenceDiv?.addEventListener('click', () => {
    confidenceCheckbox.checked = !confidenceCheckbox.checked;
    updateConfidence(confidenceCheckbox.checked);
});


ADJECTIVES = [ 
    "abandoned", "able", "absolute", "adorable", "adventurous", "academic", "acceptable", "acclaimed", "accomplished", "accurate", "aching", "acidic", "acrobatic", "active", "actual", "adept", "admirable", "admired", "adolescent", "adorable", "adored", "advanced", "afraid", "affectionate", "aged", "aggravating", "aggressive", "agile", "agitated", "agonizing", "agreeable", "ajar", "alarmed", "alarming", "alert", "alienated", "alive", "all", "altruistic", "amazing", "ambitious", "ample", "amused", "amusing", "anchored", "ancient", "angelic", "angry", "anguished", "animated", "annual", "another", "antique", "anxious", "any", "apprehensive", "appropriate", "apt", "arctic", "arid", "aromatic", "artistic", "ashamed", "assured", "astonishing", "athletic", "attached", "attentive", "attractive", "austere", "authentic", "authorized", "automatic", "avaricious", "average", "aware", "awesome", "awful", "awkward", "babyish", "bad", "back", "baggy", "bare", "barren", "basic", "beautiful", "belated", "beloved", "beneficial", "better", "best", "bewitched", "big", "big-hearted", "biodegradable", "bite-sized", "bitter", "black", "black-and-white", "bland", "blank", "blaring", "bleak", "blind", "blissful", "blond", "blue", "blushing", "bogus", "boiling", "bold", "bony", "boring", "bossy", "both", "bouncy", "bountiful", "bowed", "brave", "breakable", "brief", "bright", "brilliant", "brisk", "broken", "bronze", "brown", "bruised", "bubbly", "bulky", "bumpy", "buoyant", "burdensome", "burly", "bustling", "busy", "buttery", "buzzing", "calculating", "calm", "candid", "canine", "capital", "carefree", "careful", "careless", "caring", "cautious", "cavernous", "celebrated", "charming", "cheap", "cheerful", "cheery", "chief", "chilly", "chubby", "circular", "classic", "clean", "clear", "clear-cut", "clever", "close", "closed", "cloudy", "clueless", "clumsy", "cluttered", "coarse", "cold", "colorful", "colorless", "colossal", "comfortable", "common", "compassionate", "competent", "complete", "complex", "complicated", "composed", "concerned", "concrete", "confused", "conscious", "considerate", "constant", "content", "conventional", "cooked", "cool", "cooperative", "coordinated", "corny", "corrupt", "costly", "courageous", "courteous", "crafty", "crazy", "creamy", "creative", "creepy", "criminal", "crisp", "critical", "crooked", "crowded", "cruel", "crushing", "cuddly", "cultivated", "cultured", "cumbersome", "curly", "curvy", "cute", "cylindrical", "damaged", "damp", "dangerous", "dapper", "daring", "darling", "dark", "dazzling", "dead", "deadly", "deafening", "dear", "dearest", "decent", "decimal", "decisive", "deep", "defenseless", "defensive", "defiant", "deficient", "definite", "definitive", "delayed", "delectable", "delicious", "delightful", "delirious", "demanding", "dense", "dental", "dependable", "dependent", "descriptive", "deserted", "detailed", "determined", "devoted", "different", "difficult", "digital", "diligent", "dim", "dimpled", "dimwitted", "direct", "disastrous", "discrete", "disfigured", "disgusting", "disloyal", "dismal", "distant", "downright", "dreary", "dirty", "disguised", "dishonest", "dismal", "distant", "distinct", "distorted", "dizzy", "dopey", "doting", "double", "downright", "drab", "drafty", "dramatic", "dreary", "droopy", "dry", "dual", "dull", "dutiful", "each", "eager", "earnest", "early", "easy", "easy-going", "ecstatic", "edible", "educated", "elaborate", "elastic", "elated", "elderly", "electric", "elegant", "elementary", "elliptical", "embarrassed", "embellished", "eminent", "emotional", "empty", "enchanted", "enchanting", "energetic", "enlightened", "enormous", "enraged", "entire", "envious", "equal", "equatorial", "essential", "esteemed", "ethical", "euphoric", "even", "evergreen", "everlasting", "every", "evil", "exalted", "excellent", "exemplary", "exhausted", "excitable", "excited", "exciting", "exotic", "expensive", "experienced", "expert", "extraneous", "extroverted", "extra-large", "extra-small", "fabulous", "failing", "faint", "fair", "faithful", "fake", "false", "familiar", "famous", "fancy", "fantastic", "far", "faraway", "far-flung", "far-off", "fast", "fat", "fatal", "fatherly", "favorable", "favorite", "fearful", "fearless", "feisty", "feline", "female", "feminine", "few", "fickle", "filthy", "fine", "finished", "firm", "first", "firsthand", "fitting", "fixed", "flaky", "flamboyant", "flashy", "flat", "flawed", "flawless", "flickering", "flimsy", "flippant", "flowery", "fluffy", "fluid", "flustered", "focused", "fond", "foolhardy", "foolish", "forceful", "forked", "formal", "forsaken", "forthright", "fortunate", "fragrant", "frail", "frank", "frayed", "free", "French", "fresh", "frequent", "friendly", "frightened", "frightening", "frigid", "frilly", "frizzy", "frivolous", "front", "frosty", "frozen", "frugal", "fruitful", "full", "fumbling", "functional", "funny", "fussy", "fuzzy", "gargantuan", "gaseous", "general", "generous", "gentle", "genuine", "giant", "giddy", "gigantic", "gifted", "giving", "glamorous", "glaring", "glass", "gleaming", "gleeful", "glistening", "glittering", "gloomy", "glorious", "glossy", "glum", "golden", "good", "good-natured", "gorgeous", "graceful", "gracious", "grand", "grandiose", "granular", "grateful", "grave", "gray", "great", "greedy", "green", "gregarious", "grim", "grimy", "gripping", "grizzled", "gross", "grotesque", "grouchy", "grounded", "growing", "growling", "grown", "grubby", "gruesome", "grumpy", "guilty", "gullible", "gummy", "hairy", "half", "handmade", "handsome", "handy", "happy", "happy-go-lucky", "hard", "hard-to-find", "harmful", "harmless", "harmonious", "harsh", "hasty", "hateful", "haunting", "healthy", "heartfelt", "hearty", "heavenly", "heavy", "hefty", "helpful", "helpless", "hidden", "hideous", "high", "high-level", "hilarious", "hoarse", "hollow", "homely", "honest", "honorable", "honored", "hopeful", "horrible", "hospitable", "hot", "huge", "humble", "humiliating", "humming", "humongous", "hungry", "hurtful", "husky", "icky", "icy", "ideal", "idealistic", "identical", "idle", "idiotic", "idolized", "ignorant", "ill", "illegal", "ill-fated", "ill-informed", "illiterate", "illustrious", "imaginary", "imaginative", "immaculate", "immaterial", "immediate", "immense", "impassioned", "impeccable", "impartial", "imperfect", "imperturbable", "impish", "impolite", "important", "impossible", "impractical", "impressionable", "impressive", "improbable", "impure", "inborn", "incomparable", "incompatible", "incomplete", "inconsequential", "incredible", "indelible", "inexperienced", "indolent", "infamous", "infantile", "infatuated", "inferior", "infinite", "informal", "innocent", "insecure", "insidious", "insignificant", "insistent", "instructive", "insubstantial", "intelligent", "intent", "intentional", "interesting", "internal", "international", "intrepid", "ironclad", "irresponsible", "irritating", "itchy", "jaded", "jagged", "jam-packed", "jaunty", "jealous", "jittery", "joint", "jolly", "jovial", "joyful", "joyous", "jubilant", "judicious", "juicy", "jumbo", "junior", "jumpy", "juvenile", "kaleidoscopic", "keen", "key", "kind", "kindhearted", "kindly", "klutzy", "knobby", "knotty", "knowledgeable", "knowing", "known", "kooky", "kosher", "lame", "lanky", "large", "last", "lasting", "late", "lavish", "lawful", "lazy", "leading", "lean", "leafy", "left", "legal", "legitimate", "light", "lighthearted", "likable", "likely", "limited", "limp", "limping", "linear", "lined", "liquid", "little", "live", "lively", "livid", "loathsome", "lone", "lonely", "long", "long-term", "loose", "lopsided", "lost", "loud", "lovable", "lovely", "loving", "low", "loyal", "lucky", "lumbering", "luminous", "lumpy", "lustrous", "luxurious", "mad", "made-up", "magnificent", "majestic", "major", "male", "mammoth", "married", "marvelous", "masculine", "massive", "mature", "meager", "mealy", "mean", "measly", "meaty", "medical", "mediocre", "medium", "meek", "mellow", "melodic", "memorable", "menacing", "merry", "messy", "metallic", "mild", "milky", "mindless", "miniature", "minor", "minty", "miserable", "miserly", "misguided", "misty", "mixed", "modern", "modest", "moist", "monstrous", "monthly", "monumental", "moral", "mortified", "motherly", "motionless", "mountainous", "muddy", "muffled", "multicolored", "mundane", "murky", "mushy", "musty", "muted", "mysterious", "naive", "narrow", "nasty", "natural", "naughty", "nautical", "near", "neat", "necessary", "needy", "negative", "neglected", "negligible", "neighboring", "nervous", "new", "next", "nice", "nifty", "nimble", "nippy", "nocturnal", "noisy", "nonstop", "normal", "notable", "noted", "noteworthy", "novel", "noxious", "numb", "nutritious", "nutty", "obedient", "obese", "oblong", "oily", "oblong", "obvious", "occasional", "odd", "oddball", "offbeat", "offensive", "official", "old", "old-fashioned", "only", "open", "optimal", "optimistic", "opulent", "orange", "orderly", "organic", "ornate", "ornery", "ordinary", "original", "other", "our", "outlying", "outgoing", "outlandish", "outrageous", "outstanding", "oval", "overcooked", "overdue", "overjoyed", "overlooked", "palatable", "pale", "paltry", "parallel", "parched", "partial", "passionate", "past", "pastel", "peaceful", "peppery", "perfect", "perfumed", "periodic", "perky", "personal", "pertinent", "pesky", "pessimistic", "petty", "phony", "physical", "piercing", "pink", "pitiful", "plain", "plaintive", "plastic", "playful", "pleasant", "pleased", "pleasing", "plump", "plush", "polished", "polite", "political", "pointed", "pointless", "poised", "poor", "popular", "portly", "posh", "positive", "possible", "potable", "powerful", "powerless", "practical", "precious", "present", "prestigious", "pretty", "precious", "previous", "pricey", "prickly", "primary", "prime", "pristine", "private", "prize", "probable", "productive", "profitable", "profuse", "proper", "proud", "prudent", "punctual", "pungent", "puny", "pure", "purple", "pushy", "putrid", "puzzled", "puzzling", "quaint", "qualified", "quarrelsome", "quarterly", "queasy", "querulous", "questionable", "quick", "quick-witted", "quiet", "quintessential", "quirky", "quixotic", "quizzical", "radiant", "ragged", "rapid", "rare", "rash", "raw", "recent", "reckless", "rectangular", "ready", "real", "realistic", "reasonable", "red", "reflecting", "regal", "regular", "reliable", "relieved", "remarkable", "remorseful", "remote", "repentant", "required", "respectful", "responsible", "repulsive", "revolving", "rewarding", "rich", "rigid", "right", "ringed", "ripe", "roasted", "robust", "rosy", "rotating", "rotten", "rough", "round", "rowdy", "royal", "rubbery", "rundown", "ruddy", "rude", "runny", "rural", "rusty", "sad", "safe", "salty", "same", "sandy", "sane", "sarcastic", "sardonic", "satisfied", "scaly", "scarce", "scared", "scary", "scented", "scholarly", "scientific", "scornful", "scratchy", "scrawny", "second", "secondary", "second-hand", "secret", "self-assured", "self-reliant", "selfish", "sentimental", "separate", "serene", "serious", "serpentine", "several", "severe", "shabby", "shadowy", "shady", "shallow", "shameful", "shameless", "sharp", "shimmering", "shiny", "shocked", "shocking", "shoddy", "short", "short-term", "showy", "shrill", "shy", "sick", "silent", "silky", "silly", "silver", "similar", "simple", "simplistic", "sinful", "single", "sizzling", "skeletal", "skinny", "sleepy", "slight", "slim", "slimy", "slippery", "slow", "slushy", "small", "smart", "smoggy", "smooth", "smug", "snappy", "snarling", "sneaky", "sniveling", "snoopy", "sociable", "soft", "soggy", "solid", "somber", "some", "spherical", "sophisticated", "sore", "sorrowful", "soulful", "soupy", "sour", "Spanish", "sparkling", "sparse", "specific", "spectacular", "speedy", "spicy", "spiffy", "spirited", "spiteful", "splendid", "spotless", "spotted", "spry", "square", "squeaky", "squiggly", "stable", "staid", "stained", "stale", "standard", "starchy", "stark", "starry", "steep", "sticky", "stiff", "stimulating", "stingy", "stormy", "straight", "strange", "steel", "strict", "strident", "striking", "striped", "strong", "studious", "stunning", "stupendous", "stupid", "sturdy", "stylish", "subdued", "submissive", "substantial", "subtle", "suburban", "sudden", "sugary", "sunny", "super", "superb", "superficial", "superior", "supportive", "sure-footed", "surprised", "suspicious", "svelte", "sweaty", "sweet", "sweltering", "swift", "sympathetic", "tall", "talkative", "tame", "tan", "tangible", "tart", "tasty", "tattered", "taut", "tedious", "teeming", "tempting", "tender", "tense", "tepid", "terrible", "terrific", "testy", "thankful", "that", "these", "thick", "thin", "third", "thirsty", "this", "thorough", "thorny", "those", "thoughtful", "threadbare", "thrifty", "thunderous", "tidy", "tight", "timely", "tinted", "tiny", "tired", "torn", "total", "tough", "traumatic", "treasured", "tremendous", "tragic", "trained", "tremendous", "triangular", "tricky", "trifling", "trim", "trivial", "troubled", "true", "trusting", "trustworthy", "trusty", "truthful", "tubby", "turbulent", "twin", "ugly", "ultimate", "unacceptable", "unaware", "uncomfortable", "uncommon", "unconscious", "understated", "unequaled", "uneven", "unfinished", "unfit", "unfolded", "unfortunate", "unhappy", "unhealthy", "uniform", "unimportant", "unique", "united", "unkempt", "unknown", "unlawful", "unlined", "unlucky", "unnatural", "unpleasant", "unrealistic", "unripe", "unruly", "unselfish", "unsightly", "unsteady", "unsung", "untidy", "untimely", "untried", "untrue", "unused", "unusual", "unwelcome", "unwieldy", "unwilling", "unwitting", "unwritten", "upbeat", "upright", "upset", "urban", "usable", "used", "useful", "useless", "utilized", "utter", "vacant", "vague", "vain", "valid", "valuable", "vapid", "variable", "vast", "velvety", "venerated", "vengeful", "verifiable", "vibrant", "vicious", "victorious", "vigilant", "vigorous", "villainous", "violet", "violent", "virtual", "virtuous", "visible", "vital", "vivacious", "vivid", "voluminous", "wan", "warlike", "warm", "warmhearted", "warped", "wary", "wasteful", "watchful", "waterlogged", "watery", "wavy", "wealthy", "weak", "weary", "webbed", "wee", "weekly", "weepy", "weighty", "weird", "welcome", "well-documented", "well-groomed", "well-informed", "well-lit", "well-made", "well-off", "well-to-do", "well-worn", "wet", "which", "whimsical", "whirlwind", "whispered", "white", "whole", "whopping", "wicked", "wide", "wide-eyed", "wiggly", "wild", "willing", "wilted", "winding", "windy", "winged", "wiry", "wise", "witty", "wobbly", "woeful", "wonderful", "wooden", "woozy", "wordy", "worldly", "worn", "worried", "worrisome", "worse", "worst", "worthless", "worthwhile", "worthy", "wrathful", "wretched", "writhing", "wrong", "wry", "yawning", "yearly", "yellow", "yellowish", "young", "youthful", "yummy", "zany", "zealous", "zesty", "zigzag", 
]
NOUNS = [
    "people", "history", "way", "art", "world", "information", "map", "two", "family", "government", "health", "system", "computer", "meat", "year", "thanks", "music", "person", "reading", "method", "data", "food", "understanding", "theory", "law", "bird", "literature", "problem", "software", "control", "knowledge", "power", "ability", "economics", "love", "internet", "television", "science", "library", "nature", "fact", "product", "idea", "temperature", "investment", "area", "society", "activity", "story", "industry", "media", "thing", "oven", "community", "definition", "safety", "quality", "development", "language", "management", "player", "variety", "video", "week", "security", "country", "exam", "movie", "organization", "equipment", "physics", "analysis", "policy", "series", "thought", "basis", "boyfriend", "direction", "strategy", "technology", "army", "camera", "freedom", "paper", "environment", "child", "instance", "month", "truth", "marketing", "university", "writing", "article", "department", "difference", "goal", "news", "audience", "fishing", "growth", "income", "marriage", "user", "combination", "failure", "meaning", "medicine", "philosophy", "teacher", "communication", "night", "chemistry", "disease", "disk", "energy", "nation", "road", "role", "soup", "advertising", "location", "success", "addition", "apartment", "education", "math", "moment", "painting", "politics", "attention", "decision", "event", "property", "shopping", "student", "wood", "competition", "distribution", "entertainment", "office", "population", "president", "unit", "category", "cigarette", "context", "introduction", "opportunity", "performance", "driver", "flight", "length", "magazine", "newspaper", "relationship", "teaching", "cell", "dealer", "finding", "lake", "member", "message", "phone", "scene", "appearance", "association", "concept", "customer", "death", "discussion", "housing", "inflation", "insurance", "mood", "woman", "advice", "blood", "effort", "expression", "importance", "opinion", "payment", "reality", "responsibility", "situation", "skill", "statement", "wealth", "application", "city", "county", "depth", "estate", "foundation", "grandmother", "heart", "perspective", "photo", "recipe", "studio", "topic", "collection", "depression", "imagination", "passion", "percentage", "resource", "setting", "ad", "agency", "college", "connection", "criticism", "debt", "description", "memory", "patience", "secretary", "solution", "administration", "aspect", "attitude", "director", "personality", "psychology", "recommendation", "response", "selection", "storage", "version", "alcohol", "argument", "complaint", "contract", "emphasis", "highway", "loss", "membership", "possession", "preparation", "steak", "union", "agreement", "cancer", "currency", "employment", "engineering", "entry", "interaction", "mixture", "preference", "region", "republic", "tradition", "virus", "actor", "classroom", "delivery", "device", "difficulty", "drama", "election", "engine", "football", "guidance", "hotel", "owner", "priority", "protection", "suggestion", "tension", "variation", "anxiety", "atmosphere", "awareness", "bath", "bread", "candidate", "climate", "comparison", "confusion", "construction", "elevator", "emotion", "employee", "employer", "guest", "height", "leadership", "mall", "manager", "operation", "recording", "sample", "transportation", "charity", "cousin", "disaster", "editor", "efficiency", "excitement", "extent", "feedback", "guitar", "homework", "leader", "mom", "outcome", "permission", "presentation", "promotion", "reflection", "refrigerator", "resolution", "revenue", "session", "singer", "tennis", "basket", "bonus", "cabinet", "childhood", "church", "clothes", "coffee", "dinner", "drawing", "hair", "hearing", "initiative", "judgment", "lab", "measurement", "mode", "mud", "orange", "poetry", "police", "possibility", "procedure", "queen", "ratio", "relation", "restaurant", "satisfaction", "sector", "signature", "significance", "song", "tooth", "town", "vehicle", "volume", "wife", "accident", "airport", "appointment", "arrival", "assumption", "baseball", "chapter", "committee", "conversation", "database", "enthusiasm", "error", "explanation", "farmer", "gate", "girl", "hall", "historian", "hospital", "injury", "instruction", "maintenance", "manufacturer", "meal", "perception", "pie", "poem", "presence", "proposal", "reception", "replacement", "revolution", "river", "son", "speech", "tea", "village", "warning", "winner", "worker", "writer", "assistance", "breath", "buyer", "chest", "chocolate", "conclusion", "contribution", "cookie", "courage", "dad", "desk", "drawer", "establishment", "examination", "garbage", "grocery", "honey", "impression", "improvement", "independence", "insect", "inspection", "inspector", "king", "ladder", "menu", "penalty", "piano", "potato", "profession", "professor", "quantity", "reaction", "requirement", "salad", "sister", "supermarket", "tongue", "weakness", "wedding", "affair", "ambition", "analyst", "apple", "assignment", "assistant", "bathroom", "bedroom", "beer", "birthday", "celebration", "championship", "cheek", "client", "consequence", "departure", "diamond", "dirt", "ear", "fortune", "friendship", "funeral", "gene", "girlfriend", "hat", "indication", "intention", "lady", "midnight", "negotiation", "obligation", "passenger", "pizza", "platform", "poet", "pollution", "recognition", "reputation", "shirt", "sir", "speaker", "stranger", "surgery", "sympathy", "tale", "throat", "trainer", "uncle", "youth", "time", "work", "film", "water", "money", "example", "while", "business", "study", "game", "life", "form", "air", "day", "place", "number", "part", "field", "fish", "back", "process", "heat", "hand", "experience", "job", "book", "end", "point", "type", "home", "economy", "value", "body", "market", "guide", "interest", "state", "radio", "course", "company", "price", "size", "card", "list", "mind", "trade", "line", "care", "group", "risk", "word", "fat", "force", "key", "light", "training", "name", "school", "top", "amount", "level", "order", "practice", "research", "sense", "service", "piece", "web", "boss", "sport", "fun", "house", "page", "term", "test", "answer", "sound", "focus", "matter", "kind", "soil", "board", "oil", "picture", "access", "garden", "range", "rate", "reason", "future", "site", "demand", "exercise", "image", "case", "cause", "coast", "action", "age", "bad", "boat", "record", "result", "section", "building", "mouse", "cash", "class", "nothing", "period", "plan", "store", "tax", "side", "subject", "space", "rule", "stock", "weather", "chance", "figure", "man", "model", "source", "beginning", "earth", "program", "chicken", "design", "feature", "head", "material", "purpose", "question", "rock", "salt", "act", "birth", "car", "dog", "object", "scale", "sun", "note", "profit", "rent", "speed", "style", "war", "bank", "craft", "half", "inside", "outside", "standard", "bus", "exchange", "eye", "fire", "position", "pressure", "stress", "advantage", "benefit", "box", "frame", "issue", "step", "cycle", "face", "item", "metal", "paint", "review", "room", "screen", "structure", "view", "account", "ball", "discipline", "medium", "share", "balance", "bit", "black", "bottom", "choice", "gift", "impact", "machine", "shape", "tool", "wind", "address", "average", "career", "culture", "morning", "pot", "sign", "table", "task", "condition", "contact", "credit", "egg", "hope", "ice", "network", "north", "square", "attempt", "date", "effect", "link", "post", "star", "voice", "capital", "challenge", "friend", "self", "shot", "brush", "couple", "debate", "exit", "front", "function", "lack", "living", "plant", "plastic", "spot", "summer", "taste", "theme", "track", "wing", "brain", "button", "click", "desire", "foot", "gas", "influence", "notice", "rain", "wall", "base", "damage", "distance", "feeling", "pair", "savings", "staff", "sugar", "target", "text", "animal", "author", "budget", "discount", "file", "ground", "lesson", "minute", "officer", "phase", "reference", "register", "sky", "stage", "stick", "title", "trouble", "bowl", "bridge", "campaign", "character", "club", "edge", "evidence", "fan", "letter", "lock", "maximum", "novel", "option", "pack", "park", "plenty", "quarter", "skin", "sort", "weight", "baby", "background", "carry", "dish", "factor", "fruit", "glass", "joint", "master", "muscle", "red", "strength", "traffic", "trip", "vegetable", "appeal", "chart", "gear", "ideal", "kitchen", "land", "log", "mother", "net", "party", "principle", "relative", "sale", "season", "signal", "spirit", "street", "tree", "wave", "belt", "bench", "commission", "copy", "drop", "minimum", "path", "progress", "project", "sea", "south", "status", "stuff", "ticket", "tour", "angle", "blue", "breakfast", "confidence", "daughter", "degree", "doctor", "dot", "dream", "duty", "essay", "father", "fee", "finance", "hour", "juice", "limit", "luck", "milk", "mouth", "peace", "pipe", "seat", "stable", "storm", "substance", "team", "trick", "afternoon", "bat", "beach", "blank", "catch", "chain", "consideration", "cream", "crew", "detail", "gold", "interview", "kid", "mark", "match", "mission", "pain", "pleasure", "score", "screw", "sex", "shop", "shower", "suit", "tone", "window", "agent", "band", "block", "bone", "calendar", "cap", "coat", "contest", "corner", "court", "cup", "district", "door", "east", "finger", "garage", "guarantee", "hole", "hook", "implement", "layer", "lecture", "lie", "manner", "meeting", "nose", "parking", "partner", "profile", "respect", "rice", "routine", "schedule", "swimming", "telephone", "tip", "winter", "airline", "bag", "battle", "bed", "bill", "bother", "cake", "code", "curve", "designer", "dimension", "dress", "ease", "emergency", "evening", "extension", "farm", "fight", "gap", "grade", "holiday", "horror", "horse", "host", "husband", "loan", "mistake", "mountain", "nail", "noise", "occasion", "package", "patient", "pause", "phrase", "proof", "race", "relief", "sand", "sentence", "shoulder", "smoke", "stomach", "string", "tourist", "towel", "vacation", "west", "wheel", "wine", "arm", "aside", "associate", "bet", "blow", "border", "branch", "breast", "brother", "buddy", "bunch", "chip", "coach", "cross", "document", "draft", "dust", "expert", "floor", "god", "golf", "habit", "iron", "judge", "knife", "landscape", "league", "mail", "mess", "native", "opening", "parent", "pattern", "pin", "pool", "pound", "request", "salary", "shame", "shelter", "shoe", "silver", "tackle", "tank", "trust", "assist", "bake", "bar", "bell", "bike", "blame", "boy", "brick", "chair", "closet", "clue", "collar", "comment", "conference", "devil", "diet", "fear", "fuel", "glove", "jacket", "lunch", "monitor", "mortgage", "nurse", "pace", "panic", "peak", "plane", "reward", "row", "sandwich", "shock", "spite", "spray", "surprise", "till", "transition", "weekend", "welcome", "yard", "alarm", "bend", "bicycle", "bite", "blind", "bottle", "cable", "candle", "clerk", "cloud", "concert", "counter", "flower", "grandfather", "harm", "knee", "lawyer", "leather", "load", "mirror", "neck", "pension", "plate", "purple", "ruin", "ship", "skirt", "slice", "snow", "specialist", "stroke", "switch", "trash", "tune", "zone", "anger", "award", "bid", "bitter", "boot", "bug", "camp", "candy", "carpet", "cat", "champion", "channel", "clock", "comfort", "cow", "crack", "engineer", "entrance", "fault", "grass", "guy", "hell", "highlight", "incident", "island", "joke", "jury", "leg", "lip", "mate", "motor", "nerve", "passage", "pen", "pride", "priest", "prize", "promise", "resident", "resort", "ring", "roof", "rope", "sail", "scheme", "script", "sock", "station", "toe", "tower", "truck", "witness", "a", "you", "it", "can", "will", "if", "one", "many", "most", "other", "use", "make", "good", "look", "help", "go", "great", "being", "few", "might", "still", "public", "read", "keep", "start", "give", "human", "local", "general", "she", "specific", "long", "play", "feel", "high", "tonight", "put", "common", "set", "change", "simple", "past", "big", "possible", "particular", "today", "major", "personal", "current", "national", "cut", "natural", "physical", "show", "try", "check", "second", "call", "move", "pay", "let", "increase", "single", "individual", "turn", "ask", "buy", "guard", "hold", "main", "offer", "potential", "professional", "international", "travel", "cook", "alternative", "following", "special", "working", "whole", "dance", "excuse", "cold", "commercial", "low", "purchase", "deal", "primary", "worth", "fall", "necessary", "positive", "produce", "search", "present", "spend", "talk", "creative", "tell", "cost", "drive", "green", "support", "glad", "remove", "return", "run", "complex", "due", "effective", "middle", "regular", "reserve", "independent", "leave", "original", "reach", "rest", "serve", "watch", "beautiful", "charge", "active", "break", "negative", "safe", "stay", "visit", "visual", "affect", "cover", "report", "rise", "walk", "white", "beyond", "junior", "pick", "unique", "anything", "classic", "final", "lift", "mix", "private", "stop", "teach", "western", "concern", "familiar", "fly", "official", "broad", "comfortable", "gain", "maybe", "rich", "save", "stand", "young", "fail", "heavy", "hello", "lead", "listen", "valuable", "worry", "handle", "leading", "meet", "release", "sell", "finish", "normal", "press", "ride", "secret", "spread", "spring", "tough", "wait", "brown", "deep", "display", "flow", "hit", "objective", "shoot", "touch", "cancel", "chemical", "cry", "dump", "extreme", "push", "conflict", "eat", "fill", "formal", "jump", "kick", "opposite", "pass", "pitch", "remote", "total", "treat", "vast", "abuse", "beat", "burn", "deposit", "print", "raise", "sleep", "somewhere", "advance", "anywhere", "consist", "dark", "double", "draw", "equal", "fix", "hire", "internal", "join", "kill", "sensitive", "tap", "win", "attack", "claim", "constant", "drag", "drink", "guess", "minor", "pull", "raw", "soft", "solid", "wear", "weird", "wonder", "annual", "count", "dead", "doubt", "feed", "forever", "impress", "nobody", "repeat", "round", "sing", "slide", "strip", "whereas", "wish", "combine", "command", "dig", "divide", "equivalent", "hang", "hunt", "initial", "march", "mention", "smell", "spiritual", "survey", "tie", "adult", "brief", "crazy", "escape", "gather", "hate", "prior", "repair", "rough", "sad", "scratch", "sick", "strike", "employ", "external", "hurt", "illegal", "laugh", "lay", "mobile", "nasty", "ordinary", "respond", "royal", "senior", "split", "strain", "struggle", "swim", "train", "upper", "wash", "yellow", "convert", "crash", "dependent", "fold", "funny", "grab", "hide", "miss", "permit", "quote", "recover", "resolve", "roll", "sink", "slip", "spare", "suspect", "sweet", "swing", "twist", "upstairs", "usual", "abroad", "brave", "calm", "concentrate", "estimate", "grand", "male", "mine", "prompt", "quiet", "refuse", "regret", "reveal", "rush", "shake", "shift", "shine", "steal", "suck", "surround", "anybody", "bear", "brilliant", "dare", "dear", "delay", "drunk", "female", "hurry", "inevitable", "invite", "kiss", "neat", "pop", "punch", "quit", "reply", "representative", "resist", "rip", "rub", "silly", "smile", "spell", "stretch", "stupid", "tear", "temporary", "tomorrow", "wake", "wrap", "yesterday", 
]

// Filter arrays to remove words longer than 6 characters
const SHORT_ADJECTIVES = ADJECTIVES.filter(w => w.length <= 6);
const SHORT_NOUNS = NOUNS.filter(w => w.length <= 6);

// Deterministic hash function to get run name
function getRunName(id) {
    const num = parseInt(id);
    const adjIdx = (num * 2654435761) % SHORT_ADJECTIVES.length;
    const nounIdx = (num * 2654435789) % SHORT_NOUNS.length;
    return `${SHORT_ADJECTIVES[adjIdx]}-${SHORT_NOUNS[nounIdx]}`;
}

// Time ago function
function getTimeAgo(timestamp) {
    if (!timestamp || isNaN(timestamp)) return '';
    const now = Date.now() / 1000; // Current time in seconds
    const diff = Math.floor(now - timestamp);
    
    if (diff < 0) return 'now';
    if (diff < 60) return `${diff}s`;
    if (diff < 3600) return `${Math.floor(diff / 60)}min`;
    if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
    if (diff < 604800) return `${Math.floor(diff / 86400)}d`;
    if (diff < 2592000) return `${Math.floor(diff / 604800)}w`;
    return `${Math.floor(diff / 2592000)}mo`;
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</body>
</html>